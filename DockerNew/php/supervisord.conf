[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
loglevel=info

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700
username=supervisor
password=supervisor

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock
username=supervisor
password=supervisor

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

####################################################################################################
# PHP-FPM - Main web application process
####################################################################################################
[program:php-fpm]
command=php-fpm -F
directory=/var/www/html
user=www
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/php-fpm.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
priority=100

####################################################################################################
# Laravel Queue Worker - Background job processing
####################################################################################################
[program:laravel-queue]
command=php artisan queue:work database --sleep=3 --tries=3 --max-time=3600 --memory=256 --timeout=90
directory=/var/www/html
user=www
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/laravel-queue.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
priority=200
# Restart on failure after 1 second
startsecs=1
startretries=3

####################################################################################################
# Laravel Scheduler - Cron job replacement
####################################################################################################
[program:laravel-scheduler]
command=php artisan schedule:work
directory=/var/www/html
user=www
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/laravel-scheduler.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
priority=300
# Restart on failure after 1 second
startsecs=1
startretries=3

####################################################################################################
# Process Groups for easier management
####################################################################################################
[group:laravel]
programs=php-fpm,laravel-queue,laravel-scheduler
priority=100